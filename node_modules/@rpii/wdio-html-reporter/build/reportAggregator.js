"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _htmlGenerator = _interopRequireDefault(require("./htmlGenerator"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const open = require('open');

let copyfiles = require("copyfiles");

const fs = require('fs-extra');

const path = require('path');

const moment = require('moment');

const logger = require('@log4js-node/log4js-api');

function walk(dir, extensions, filelist = []) {
  const files = fs.readdirSync(dir);
  files.forEach(function (file) {
    const filepath = path.join(dir, file);
    const stat = fs.statSync(filepath);

    if (stat.isDirectory()) {
      filelist = walk(filepath, extensions, filelist);
    } else {
      extensions.forEach(function (extension) {
        if (file.indexOf(extension) == file.length - extension.length) {
          filelist.push(filepath);
        }
      });
    }
  });
  return filelist;
}

class ReportAggregator {
  constructor(opts) {
    opts = Object.assign({}, {
      outputDir: 'reports/html-reports/',
      filename: 'master-report.html',
      reportTitle: 'Test Master Report',
      showInBrowser: false,
      templateFilename: path.resolve(__dirname, '../templates/wdio-html-reporter-template.hbs'),
      templateFuncs: {},
      browserName: "not specified",
      LOG: null
    }, opts);
    this.options = opts;

    if (!this.options.LOG) {
      this.options.LOG = logger.getLogger("default");
    }

    this.options.reportFile = path.join(process.cwd(), this.options.outputDir, this.options.filename);
    this.reports = [];
  }

  clean() {
    fs.emptyDirSync(this.options.outputDir);
  }

  readJsonFiles() {
    return walk(this.options.outputDir, [".json"]);
  }

  log(message, object) {
    if (this.options.LOG) {
      this.options.LOG.debug(message + object);
    }
  }

  async createReport() {
    if (this.options.LOG) {
      this.options.LOG.debug("Report Aggregation started");
    }

    let metrics = {
      passed: 0,
      skipped: 0,
      failed: 0,
      start: new moment(),
      end: new moment(),
      duration: 0
    };
    let suites = [];
    let specs = [];
    let files = this.readJsonFiles();

    for (let i = 0; i < files.length; i++) {
      try {
        let filename = files[i];
        let report = JSON.parse(fs.readFileSync(filename));

        if (!report.info || !report.info.specs) {
          this.options.LOG.error("report structure in question, no info or info.specs ", JSON.stringify(report));
          this.options.LOG.info("report content: ", JSON.stringify(report));
        }

        report.info.specs.forEach(spec => {
          specs.push(spec);
        });
        this.reports.push(report);
        metrics.passed += report.metrics.passed;
        metrics.failed += report.metrics.failed;
        metrics.skipped += report.metrics.skipped;

        for (let k = 0; k < report.suites.length; k++) {
          let suite = report.suites[k];
          let start = moment.utc(suite.start);

          if (start.isSameOrBefore(metrics.start)) {
            metrics.start = start;
          }

          let end = moment.utc(suite.end);

          if (end.isAfter(metrics.end)) {
            metrics.end = end;
          }

          suites.push(suite);
        }
      } catch (ex) {
        console.error(ex);
      }
    }

    if (!this.reports || !this.reports.length) {
      // the test failed hard at the beginning.  Create a dummy structure to get through html generation
      let report = {
        "info": {
          "cid": "The execution of the test suite has failed before report generation was started.  Please look at the logs to determine the error, this is likely an issue with your configuration files.",
          "config": {
            "hostname": "localhost"
          },
          "specs": [],
          "suites": [{
            "uid": "Test Start Failure",
            "title": "Test Start Failure",
            "type": "suite",
            "tests": []
          }]
        }
      };
      this.reports = [];
      this.reports.push(report);
    }

    let duration = metrics.end.diff(metrics.start);
    metrics.duration = moment.duration(duration, "milliseconds").format('hh:mm:ss.SS', {
      trim: false
    });
    metrics.start = metrics.start.format();
    metrics.end = metrics.end.format();
    const reportOptions = {
      data: {
        info: this.reports[0].info,
        specs: specs,
        metrics: metrics,
        suites: suites,
        title: this.options.reportTitle,
        browserName: this.options.browserName
      },
      outputDir: this.options.outputDir,
      reportFile: this.options.reportFile,
      templateFilename: this.options.templateFilename,
      LOG: this.options.LOG,
      templateFuncs: this.options.templateFuncs,
      showInBrowser: this.options.showInBrowser,
      collapseTests: this.options.collapseTests
    };

    if (this.options.LOG) {
      this.options.LOG.debug("Aggregated " + specs.length + " specs, " + suites.length + " suites, " + this.reports.length + " reports, ");
    }

    _htmlGenerator.default.htmlOutput(reportOptions);

    reportOptions.LOG.debug("Report Aggregation completed");
    let jsFiles = path.join(__dirname, '..//templates/*.js');
    let reportDir = path.join(process.cwd(), this.options.outputDir);
    copyfiles([jsFiles, reportDir], true, () => {
      reportOptions.LOG.info('copyfiles complete : ' + jsFiles + " to " + reportDir);

      try {
        if (this.options.showInBrowser) {
          let childProcess = open(this.options.reportFile);
          childProcess.then(() => {
            reportOptions.LOG.info('browser launched');
          }, error => {
            reportOptions.LOG.error('showInBrowser error spawning :' + this.options.reportFile + " " + error.toString());
          });
        }
      } catch (ex) {
        reportOptions.LOG.error('Error opening browser:' + ex);
      }
    });
  }

}

var _default = ReportAggregator;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXBvcnRBZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbIm9wZW4iLCJyZXF1aXJlIiwiY29weWZpbGVzIiwiZnMiLCJwYXRoIiwibW9tZW50IiwibG9nZ2VyIiwid2FsayIsImRpciIsImV4dGVuc2lvbnMiLCJmaWxlbGlzdCIsImZpbGVzIiwicmVhZGRpclN5bmMiLCJmb3JFYWNoIiwiZmlsZSIsImZpbGVwYXRoIiwiam9pbiIsInN0YXQiLCJzdGF0U3luYyIsImlzRGlyZWN0b3J5IiwiZXh0ZW5zaW9uIiwiaW5kZXhPZiIsImxlbmd0aCIsInB1c2giLCJSZXBvcnRBZ2dyZWdhdG9yIiwiY29uc3RydWN0b3IiLCJvcHRzIiwiT2JqZWN0IiwiYXNzaWduIiwib3V0cHV0RGlyIiwiZmlsZW5hbWUiLCJyZXBvcnRUaXRsZSIsInNob3dJbkJyb3dzZXIiLCJ0ZW1wbGF0ZUZpbGVuYW1lIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInRlbXBsYXRlRnVuY3MiLCJicm93c2VyTmFtZSIsIkxPRyIsIm9wdGlvbnMiLCJnZXRMb2dnZXIiLCJyZXBvcnRGaWxlIiwicHJvY2VzcyIsImN3ZCIsInJlcG9ydHMiLCJjbGVhbiIsImVtcHR5RGlyU3luYyIsInJlYWRKc29uRmlsZXMiLCJsb2ciLCJtZXNzYWdlIiwib2JqZWN0IiwiZGVidWciLCJjcmVhdGVSZXBvcnQiLCJtZXRyaWNzIiwicGFzc2VkIiwic2tpcHBlZCIsImZhaWxlZCIsInN0YXJ0IiwiZW5kIiwiZHVyYXRpb24iLCJzdWl0ZXMiLCJzcGVjcyIsImkiLCJyZXBvcnQiLCJKU09OIiwicGFyc2UiLCJyZWFkRmlsZVN5bmMiLCJpbmZvIiwiZXJyb3IiLCJzdHJpbmdpZnkiLCJzcGVjIiwiayIsInN1aXRlIiwidXRjIiwiaXNTYW1lT3JCZWZvcmUiLCJpc0FmdGVyIiwiZXgiLCJjb25zb2xlIiwiZGlmZiIsImZvcm1hdCIsInRyaW0iLCJyZXBvcnRPcHRpb25zIiwiZGF0YSIsInRpdGxlIiwiY29sbGFwc2VUZXN0cyIsIkh0bWxHZW5lcmF0b3IiLCJodG1sT3V0cHV0IiwianNGaWxlcyIsInJlcG9ydERpciIsImNoaWxkUHJvY2VzcyIsInRoZW4iLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLElBQUlDLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFdBQUQsQ0FBdkI7O0FBRUEsTUFBTUUsRUFBRSxHQUFHRixPQUFPLENBQUMsVUFBRCxDQUFsQjs7QUFDQSxNQUFNRyxJQUFJLEdBQUdILE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1JLE1BQU0sR0FBR0osT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBQ0EsTUFBTUssTUFBTSxHQUFHTCxPQUFPLENBQUMseUJBQUQsQ0FBdEI7O0FBRUEsU0FBVU0sSUFBVixDQUFlQyxHQUFmLEVBQW9CQyxVQUFwQixFQUFpQ0MsUUFBUSxHQUFHLEVBQTVDLEVBQWdEO0FBQzVDLFFBQU1DLEtBQUssR0FBR1IsRUFBRSxDQUFDUyxXQUFILENBQWVKLEdBQWYsQ0FBZDtBQUVBRyxFQUFBQSxLQUFLLENBQUNFLE9BQU4sQ0FBYyxVQUFVQyxJQUFWLEVBQWdCO0FBQzFCLFVBQU1DLFFBQVEsR0FBR1gsSUFBSSxDQUFDWSxJQUFMLENBQVVSLEdBQVYsRUFBZU0sSUFBZixDQUFqQjtBQUNBLFVBQU1HLElBQUksR0FBR2QsRUFBRSxDQUFDZSxRQUFILENBQVlILFFBQVosQ0FBYjs7QUFFQSxRQUFJRSxJQUFJLENBQUNFLFdBQUwsRUFBSixFQUF3QjtBQUNwQlQsTUFBQUEsUUFBUSxHQUFHSCxJQUFJLENBQUNRLFFBQUQsRUFBV04sVUFBWCxFQUF1QkMsUUFBdkIsQ0FBZjtBQUNILEtBRkQsTUFFTztBQUNIRCxNQUFBQSxVQUFVLENBQUNJLE9BQVgsQ0FBbUIsVUFBVU8sU0FBVixFQUFxQjtBQUNwQyxZQUFJTixJQUFJLENBQUNPLE9BQUwsQ0FBYUQsU0FBYixLQUEy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QixLQUFsQixDQUF3QixtQ0FBbUMsS0FBSzdCLE9BQUwsQ0FBYUUsVUFBaEQsR0FBNkQsR0FBN0QsR0FBbUUyQixLQUFLLENBQUN1QixRQUFOLEVBQTNGO0FBQ0gsV0FOTDtBQU9IO0FBQ0osT0FaRCxDQVlFLE9BQU9mLEVBQVAsRUFBVztBQUNUSyxRQUFBQSxhQUFhLENBQUMzQyxHQUFkLENBQWtCOEIsS0FBbEIsQ0FBd0IsMkJBQTJCUSxFQUFuRDtBQUNIO0FBQ0osS0FsQkksQ0FBVDtBQXFCSDs7QUFuS2tCOztlQXdLUnBELGdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEh0bWxHZW5lcmF0b3IgZnJvbSBcIi4vaHRtbEdlbmVyYXRvclwiO1xyXG5jb25zdCBvcGVuID0gcmVxdWlyZSgnb3BlbicpO1xyXG5sZXQgY29weWZpbGVzID0gcmVxdWlyZShcImNvcHlmaWxlc1wiKTtcclxuXHJcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMtZXh0cmEnKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcclxuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XHJcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJ0Bsb2c0anMtbm9kZS9sb2c0anMtYXBpJyk7XHJcblxyXG5mdW5jdGlvbiAgd2FsayhkaXIsIGV4dGVuc2lvbnMgLCBmaWxlbGlzdCA9IFtdKSB7XHJcbiAgICBjb25zdCBmaWxlcyA9IGZzLnJlYWRkaXJTeW5jKGRpcik7XHJcblxyXG4gICAgZmlsZXMuZm9yRWFjaChmdW5jdGlvbiAoZmlsZSkge1xyXG4gICAgICAgIGNvbnN0IGZpbGVwYXRoID0gcGF0aC5qb2luKGRpciwgZmlsZSk7XHJcbiAgICAgICAgY29uc3Qgc3RhdCA9IGZzLnN0YXRTeW5jKGZpbGVwYXRoKTtcclxuXHJcbiAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xyXG4gICAgICAgICAgICBmaWxlbGlzdCA9IHdhbGsoZmlsZXBhdGgsIGV4dGVuc2lvbnMsIGZpbGVsaXN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBleHRlbnNpb25zLmZvckVhY2goZnVuY3Rpb24gKGV4dGVuc2lvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpbGUuaW5kZXhPZihleHRlbnNpb24pID09IGZpbGUubGVuZ3RoIC0gZXh0ZW5zaW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVsaXN0LnB1c2goZmlsZXBhdGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gZmlsZWxpc3Q7XHJcbn1cclxuXHJcbmNsYXNzIFJlcG9ydEFnZ3JlZ2F0b3Ige1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG9wdHMpIHtcclxuICAgICAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwge1xyXG4gICAgICAgICAgICBvdXRwdXREaXI6ICdyZXBvcnRzL2h0bWwtcmVwb3J0cy8nLFxyXG4gICAgICAgICAgICBmaWxlbmFtZTogJ21hc3Rlci1yZXBvcnQuaHRtbCcsXHJcbiAgICAgICAgICAgIHJlcG9ydFRpdGxlOiAnVGVzdCBNYXN0ZXIgUmVwb3J0JyxcclxuICAgICAgICAgICAgc2hvd0luQnJvd3NlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlRmlsZW5hbWU6IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi90ZW1wbGF0ZXMvd2Rpby1odG1sLXJlcG9ydGVyLXRlbXBsYXRlLmhicycpLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZUZ1bmNzOiB7fSxcclxuICAgICAgICAgICAgYnJvd3Nlck5hbWU6IFwibm90IHNwZWNpZmllZFwiLFxyXG4gICAgICAgICAgICBMT0c6IG51bGxcclxuICAgICAgICB9LCBvcHRzKTtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRzO1xyXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLkxPRykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HID0gbG9nZ2VyLmdldExvZ2dlcihcImRlZmF1bHRcIikgICAgICA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZXBvcnRGaWxlID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIHRoaXMub3B0aW9ucy5vdXRwdXREaXIsIHRoaXMub3B0aW9ucy5maWxlbmFtZSk7XHJcbiAgICAgICAgdGhpcy5yZXBvcnRzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYW4oKSB7XHJcbiAgICAgICAgZnMuZW1wdHlEaXJTeW5jKHRoaXMub3B0aW9ucy5vdXRwdXREaXIpO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgcmVhZEpzb25GaWxlcygpIHtcclxuICAgICAgICByZXR1cm4gd2Fsayh0aGlzLm9wdGlvbnMub3V0cHV0RGlyLCBbXCIuanNvblwiXSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGxvZyhtZXNzYWdlLG9iamVjdCkge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuTE9HKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cuZGVidWcobWVzc2FnZSArIG9iamVjdCkgO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIGNyZWF0ZVJlcG9ydCgpIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLkxPRykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmRlYnVnKFwiUmVwb3J0IEFnZ3JlZ2F0aW9uIHN0YXJ0ZWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBtZXRyaWNzID0ge1xyXG4gICAgICAgICAgICBwYXNzZWQ6IDAsXHJcbiAgICAgICAgICAgIHNraXBwZWQ6IDAsXHJcbiAgICAgICAgICAgIGZhaWxlZDogMCxcclxuICAgICAgICAgICAgc3RhcnQgOiBuZXcgbW9tZW50KCksXHJcbiAgICAgICAgICAgIGVuZCA6IG5ldyBtb21lbnQoKSxcclxuICAgICAgICAgICAgZHVyYXRpb246IDBcclxuICAgICAgICB9O1xyXG4gICAgICAgIGxldCBzdWl0ZXMgPSBbXTtcclxuICAgICAgICBsZXQgc3BlY3MgPSBbXTtcclxuXHJcbiAgICAgICAgbGV0IGZpbGVzID0gdGhpcy5yZWFkSnNvbkZpbGVzKCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGxldCBmaWxlbmFtZSA9IGZpbGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlcG9ydCA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKGZpbGVuYW1lKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlcG9ydC5pbmZvIHx8ICFyZXBvcnQuaW5mby5zcGVjcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cuZXJyb3IoXCJyZXBvcnQgc3RydWN0dXJlIGluIHF1ZXN0aW9uLCBubyBpbmZvIG9yIGluZm8uc3BlY3MgXCIgLCBKU09OLnN0cmluZ2lmeShyZXBvcnQpKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmluZm8oXCJyZXBvcnQgY29udGVudDogXCIgLCBKU09OLnN0cmluZ2lmeShyZXBvcnQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlcG9ydC5pbmZvLnNwZWNzLmZvckVhY2goKHNwZWMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzcGVjcy5wdXNoKHNwZWMpIDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG9ydHMucHVzaChyZXBvcnQpO1xyXG4gICAgICAgICAgICAgICAgbWV0cmljcy5wYXNzZWQgKz0gcmVwb3J0Lm1ldHJpY3MucGFzc2VkO1xyXG4gICAgICAgICAgICAgICAgbWV0cmljcy5mYWlsZWQgKz0gcmVwb3J0Lm1ldHJpY3MuZmFpbGVkO1xyXG4gICAgICAgICAgICAgICAgbWV0cmljcy5za2lwcGVkICs9IHJlcG9ydC5tZXRyaWNzLnNraXBwZWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCByZXBvcnQuc3VpdGVzLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN1aXRlID0gcmVwb3J0LnN1aXRlc1trXSA7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXJ0ID0gbW9tZW50LnV0YyhzdWl0ZS5zdGFydCkgO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICggc3RhcnQuaXNTYW1lT3JCZWZvcmUobWV0cmljcy5zdGFydCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcy5zdGFydCA9ICBzdGFydCA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBlbmQgPSBtb21lbnQudXRjKHN1aXRlLmVuZCkgO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICggZW5kLmlzQWZ0ZXIobWV0cmljcy5lbmQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldHJpY3MuZW5kID0gIGVuZCA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHN1aXRlcy5wdXNoKHN1aXRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMucmVwb3J0cyB8fCAhdGhpcy5yZXBvcnRzLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgLy8gdGhlIHRlc3QgZmFpbGVkIGhhcmQgYXQgdGhlIGJlZ2lubmluZy4gIENyZWF0ZSBhIGR1bW15IHN0cnVjdHVyZSB0byBnZXQgdGhyb3VnaCBodG1sIGdlbmVyYXRpb25cclxuICAgICAgICAgICAgbGV0IHJlcG9ydCA9IHtcclxuICAgICAgICAgICAgICAgIFwiaW5mb1wiIDoge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiY2lkXCI6IFwiVGhlIGV4ZWN1dGlvbiBvZiB0aGUgdGVzdCBzdWl0ZSBoYXMgZmFpbGVkIGJlZm9yZSByZXBvcnQgZ2VuZXJhdGlvbiB3YXMgc3RhcnRlZC4gIFBsZWFzZSBsb29rIGF0IHRoZSBsb2dzIHRvIGRldGVybWluZSB0aGUgZXJyb3IsIHRoaXMgaXMgbGlrZWx5IGFuIGlzc3VlIHdpdGggeW91ciBjb25maWd1cmF0aW9uIGZpbGVzLlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiY29uZmlnXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJob3N0bmFtZVwiOiBcImxvY2FsaG9zdFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFwic3BlY3NcIjogW10sXHJcbiAgICAgICAgICAgICAgICBcInN1aXRlc1wiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVpZFwiOiBcIlRlc3QgU3RhcnQgRmFpbHVyZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiVGVzdCBTdGFydCBGYWlsdXJlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInN1aXRlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGVzdHNcIjogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5yZXBvcnRzID0gW10gO1xyXG4gICAgICAgICAgICB0aGlzLnJlcG9ydHMucHVzaChyZXBvcnQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGR1cmF0aW9uID0gbWV0cmljcy5lbmQuZGlmZihtZXRyaWNzLnN0YXJ0KSA7XHJcbiAgICAgICAgbWV0cmljcy5kdXJhdGlvbiA9IG1vbWVudC5kdXJhdGlvbihkdXJhdGlvbiwgXCJtaWxsaXNlY29uZHNcIikuZm9ybWF0KCdoaDptbTpzcy5TUycsIHt0cmltOiBmYWxzZX0pO1xyXG4gICAgICAgIG1ldHJpY3Muc3RhcnQgPSBtZXRyaWNzLnN0YXJ0LmZvcm1hdCgpIDtcclxuICAgICAgICBtZXRyaWNzLmVuZCA9IG1ldHJpY3MuZW5kLmZvcm1hdCgpIDtcclxuXHJcbiAgICAgICAgY29uc3QgcmVwb3J0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgaW5mbzogdGhpcy5yZXBvcnRzWzBdLmluZm8sXHJcbiAgICAgICAgICAgICAgICBzcGVjczpzcGVjcyxcclxuICAgICAgICAgICAgICAgIG1ldHJpY3M6IG1ldHJpY3MsXHJcbiAgICAgICAgICAgICAgICBzdWl0ZXM6IHN1aXRlcyxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLm9wdGlvbnMucmVwb3J0VGl0bGUsXHJcbiAgICAgICAgICAgICAgICBicm93c2VyTmFtZTogdGhpcy5vcHRpb25zLmJyb3dzZXJOYW1lXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG91dHB1dERpcjogdGhpcy5vcHRpb25zLm91dHB1dERpcixcclxuICAgICAgICAgICAgcmVwb3J0RmlsZTogdGhpcy5vcHRpb25zLnJlcG9ydEZpbGUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlRmlsZW5hbWU6IHRoaXMub3B0aW9ucy50ZW1wbGF0ZUZpbGVuYW1lLFxyXG4gICAgICAgICAgICBMT0cgOiB0aGlzLm9wdGlvbnMuTE9HLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZUZ1bmNzOiB0aGlzLm9wdGlvbnMudGVtcGxhdGVGdW5jcyxcclxuICAgICAgICAgICAgc2hvd0luQnJvd3NlcjogdGhpcy5vcHRpb25zLnNob3dJbkJyb3dzZXIsXHJcbiAgICAgICAgICAgIGNvbGxhcHNlVGVzdHM6IHRoaXMub3B0aW9ucy5jb2xsYXBzZVRlc3RzXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5MT0cpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRy5kZWJ1ZyhcIkFnZ3JlZ2F0ZWQgXCIgKyBzcGVjcy5sZW5ndGggKyBcIiBzcGVjcywgXCIgKyBzdWl0ZXMubGVuZ3RoICsgXCIgc3VpdGVzLCBcIiArIHRoaXMucmVwb3J0cy5sZW5ndGggKyBcIiByZXBvcnRzLCBcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEh0bWxHZW5lcmF0b3IuaHRtbE91dHB1dChyZXBvcnRPcHRpb25zKTtcclxuICAgICAgICByZXBvcnRPcHRpb25zLkxPRy5kZWJ1ZyhcIlJlcG9ydCBBZ2dyZWdhdGlvbiBjb21wbGV0ZWRcIik7XHJcbiAgICAgICAgbGV0IGpzRmlsZXMgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vL3RlbXBsYXRlcy8qLmpzJyk7XHJcbiAgICAgICAgbGV0IHJlcG9ydERpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0aGlzLm9wdGlvbnMub3V0cHV0RGlyKTtcclxuICAgICAgICBjb3B5ZmlsZXMoIFtqc0ZpbGVzLCByZXBvcnREaXJdICwgdHJ1ZSxcclxuICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuaW5mbyggJ2NvcHlmaWxlcyBjb21wbGV0ZSA6ICcgKyBqc0ZpbGVzICArIFwiIHRvIFwiICsgcmVwb3J0RGlyKSA7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2hvd0luQnJvd3Nlcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoaWxkUHJvY2VzcyA9IG9wZW4odGhpcy5vcHRpb25zLnJlcG9ydEZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3MudGhlbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRPcHRpb25zLkxPRy5pbmZvKCdicm93c2VyIGxhdW5jaGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuZXJyb3IoJ3Nob3dJbkJyb3dzZXIgZXJyb3Igc3Bhd25pbmcgOicgKyB0aGlzLm9wdGlvbnMucmVwb3J0RmlsZSArIFwiIFwiICsgZXJyb3IudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuZXJyb3IoJ0Vycm9yIG9wZW5pbmcgYnJvd3NlcjonICsgZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG5cclxuICAgIH1cclxuXHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSZXBvcnRBZ2dyZWdhdG9yO1xyXG4iXX0=